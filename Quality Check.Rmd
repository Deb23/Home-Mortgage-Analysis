---
title: "Quality Check"
author: "Debasmita Basak"
date: "October 30, 2016"
output: word_document
---

```{r}
setwd("C:/Users/debas/Documents/CapitalOne")
library(data.table)
library(sqldf)
library(ggplot2)
library(scales)
library(ggthemes)
library(plyr)
library(stringr)

source("HMDA_API.R")

hmda<-hmda_init()
```
Quality Check for Loan Amount:

1) NULL Values:
```{r}
sum(is.na(hmda$Loan_Amount_000))
```

2) Redundant data check:
```{r}
df <- sqldf('select Respondent_ID,As_of_Year,Agency_Code,Sequence_Number, count(*) from hmda  group by Respondent_ID,As_of_Year,Agency_Code,Sequence_Number')
df[which(df$`count(*)`>1),]
```

3) 0 and -ve Loan Amount check
```{r}
summary(hmda$Loan_Amount_000)
```

4) Outliers Analysis
```{r}
  boxplot(hmda$Loan_Amount_000, log="y", ylab="Loan Amount in Thousands",col=c("lightblue"))

```
We can see that there are a number of outliers in Loan Amount. We will check the basic statistics of this Attribute

```{r}
bxp <- boxplot(hmda$Loan_Amount_000, log="y")
uw <- bxp$stats[c(1,2,3,4,5)]
names(uw) <- (c("Lower Whisker","1st Qu.", "Median", "3rd Qu.","Upper Whisker"))
print(uw)
```

We can see that the max value of $9,96,20,000 is far higher than the upper whisker of $6,38,000. We will check the % of data containing the outliers.

```{r}
print(sum(hmda$Loan_Amount_000>uw[5])*100/nrow(hmda))

```
We see a lot of outliers - 38983 loan applications which have Loan Amount > upper quartile.
However they amount to only 2.95% of entire dataset.

Study the Distribution of outliers:
```{r}
qplot(hmda$IncomeCategory, hmda$Loan_Amount_000, data = hmda, geom = "jitter",alpha = I(1 / 5))
```
We can see that all the states especially DC, the bulk of Loan Originated ($) is generated by Upper Income category applicants. On the other hand the LMI and MUM category of applicants end up buying loans of almost equivalent net amount. Should dive deeper to verify whether these are tolerable values or manual entry errors.




Quality Check for Respondent Name:

1) NULL Value check:
```{r}
sum(is.na(hmda$Respondent_Name_TS))
```
There are no NAs in Respondent Name

2) Spell Check:
```{r}
d <- as.data.frame(sort(unique(hmda$Respondent_Name_TS)))
names(d) <- c("Respondent_Name_TS")
sqldf('select Respondent_Name_TS from d where Respondent_Name_TS like "WESTSTAR MORTGAGE%"')
```
Observation: 

1) Respondent Name contains a lot of variation in the name of the same institution. For E.g above, The WESTSTAR MORTGAGE INC has 3 different variations due to unwanted white spaces.

2) There are variations due to abbreviation. E.g.
```{r}
sqldf('select Respondent_Name_TS from d where Respondent_Name_TS like "XCEED%"')
```

Recommendations:

1) In order to limit the variation in Respondent Name due to manual entry, a process to maintain a word bank (conating valid, allowed institution names) should be incorporated. Manually entered values can be mapped against this word bank and the nearest match can be identified in order to rectify the data.

2) Loan Amount has 2.9% outliers with extremely high values. SMEs should be consulted to identify whetther these are tolerable or should be rejected as errorneous records.

3) Attributes like Applicant Income should also be monitored for accurate data. This attribute could be crucial for Segmentation and customer profiling

4) Credit rating, Interest Rates, Term period could also be added to the data and monitored for better analysis.
